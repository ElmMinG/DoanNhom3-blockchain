<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập | Charity Token DAO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background: radial-gradient(circle at 10% 20%, rgb(17, 24, 39) 0%, rgb(88, 28, 135) 90%); color: #fff; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .glass-panel { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; width: 100%; max-width: 400px; padding: 40px; }
        .form-control { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); color: white; padding: 12px; }
        .form-control:focus { background: rgba(0, 0, 0, 0.5); border-color: #8b5cf6; color: white; box-shadow: none; }
        .btn-gradient { background: linear-gradient(90deg, #8b5cf6, #d946ef); border: none; color: white; font-weight: bold; padding: 12px; width: 100%; border-radius: 8px; transition: 0.3s; }
        .toggle-link { color: #d946ef; cursor: pointer; text-decoration: none; font-weight: 600; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="glass-panel">
        <div class="text-center mb-4"><i class="fa-solid fa-coins text-warning fa-3x mb-2"></i><h3 class="fw-bold">Charity<span class="text-primary">TokenDAO</span></h3></div>
        
        <!-- Form Đăng Nhập -->
        <div id="loginForm">
            <h5 class="mb-3">Đăng nhập</h5>
            <div class="mb-3"><input type="email" id="loginUser" class="form-control" placeholder="Email (VD: abc@gmail.com)"></div>
            <div class="mb-4"><input type="password" id="loginPass" class="form-control" placeholder="Mật khẩu"></div>
            <button class="btn-gradient mb-3" onclick="handleLogin()">Vào Hệ Thống</button>
            <div class="text-center text-small">Chưa có tài khoản? <span class="toggle-link" onclick="toggleForm()">Đăng ký</span></div>
        </div>

        <!-- Form Đăng Ký -->
        <div id="registerForm" class="hidden">
            <h5 class="mb-3">Đăng ký</h5>
            <div class="mb-3"><input type="email" id="regUser" class="form-control" placeholder="Email"></div>
            <div class="mb-3"><input type="password" id="regPass" class="form-control" placeholder="Mật khẩu (tối thiểu 6 ký tự)"></div>
            <button class="btn-gradient mb-3" onclick="handleRegister()">Đăng Ký Ngay</button>
            <div class="text-center text-small">Đã có tài khoản? <span class="toggle-link" onclick="toggleForm()">Đăng nhập</span></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- CODE KẾT NỐI FIREBASE CHUẨN -->
    <script type="module">
        // Import từ CDN (Quan trọng để chạy trên trình duyệt)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // CẤU HÌNH CỦA BẠN (Tôi đã copy chính xác từ tin nhắn bạn gửi)
        const firebaseConfig = {
          apiKey: "AIzaSyDlPDPd25TrFtprJkdGqN3Z0toXAJMlTH0",
          authDomain: "charitydao-db.firebaseapp.com",
          projectId: "charitydao-db",
          storageBucket: "charitydao-db.firebasestorage.app",
          messagingSenderId: "143679423386",
          appId: "1:143679423386:web:c9a3b6f0a74ac24fc73023",
          measurementId: "G-JC76H968DW"
        };

        // Khởi tạo Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Hàm Đăng Ký
        window.handleRegister = () => {
            const email = document.getElementById('regUser').value;
            const pass = document.getElementById('regPass').value;

            if(!email || !pass) return Swal.fire('Lỗi', 'Vui lòng nhập đủ thông tin', 'warning');

            createUserWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    Swal.fire('Thành công', 'Đăng ký thành công! Mời đăng nhập.', 'success');
                    toggleForm();
                })
                .catch((error) => {
                    let msg = error.message;
                    if(error.code === 'auth/email-already-in-use') msg = 'Email này đã được sử dụng!';
                    if(error.code === 'auth/weak-password') msg = 'Mật khẩu phải có ít nhất 6 ký tự!';
                    Swal.fire('Lỗi Đăng Ký', msg, 'error');
                });
        }

        // Hàm Đăng Nhập
        window.handleLogin = () => {
            const email = document.getElementById('loginUser').value;
            const pass = document.getElementById('loginPass').value;

            signInWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    const user = userCredential.user;
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('currentUser', user.email);
                    
                    Swal.fire({
                        title: 'Đăng nhập thành công!',
                        text: 'Đang chuyển hướng...',
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = 'index.html';
                    });
                })
                .catch((error) => {
                    console.error(error); // Xem lỗi chi tiết ở Console nếu cần
                    Swal.fire('Thất bại', 'Sai email hoặc mật khẩu (hoặc chưa bật Authentication)', 'error');
                });
        }

        window.toggleForm = () => {
            document.getElementById('loginForm').classList.toggle('hidden');
            document.getElementById('registerForm').classList.toggle('hidden');
        }
    </script>
</body>
</html>